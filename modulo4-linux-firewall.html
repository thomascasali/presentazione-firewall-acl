<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modulo 4 - Firewall Linux</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #0a0e17; color: #f1f5f9; font-family: 'Inter', sans-serif; }
    #root { min-height: 100vh; }
    @media (max-width: 768px) {
      .slide-content { padding: 16px !important; }
      .slide-content h1 { font-size: 28px !important; }
      .slide-content h2 { font-size: 20px !important; }
      .slide-content h3 { font-size: 16px !important; }
      pre { font-size: 10px !important; }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;
    const colors = { bg: '#0a0e17', bgCard: '#111827', bgLight: '#1e293b', accent: '#0ea5e9', accentAlt: '#38bdf8', text: '#f1f5f9', textDim: '#94a3b8', textMuted: '#64748b', border: '#334155', success: '#22c55e', danger: '#ef4444', warn: '#f59e0b', info: '#0ea5e9', purple: '#a78bfa', cyan: '#22d3ee', yellow: '#fbbf24' };
    const Code = ({ children, title }) => (<div style={{ background: '#0d1117', borderRadius: '8px', border: `1px solid ${colors.border}`, margin: '12px 0', overflow: 'hidden' }}>{title && <div style={{ background: '#161b22', padding: '8px 16px', borderBottom: `1px solid ${colors.border}`, fontFamily: 'monospace', fontSize: '11px', color: colors.textDim }}><span style={{color: colors.accent}}>‚óè</span> {title}</div>}<pre style={{ margin: 0, padding: '14px', fontFamily: 'JetBrains Mono, monospace', fontSize: '11px', lineHeight: '1.6', color: colors.text, overflowX: 'auto', whiteSpace: 'pre-wrap' }}>{children}</pre></div>);
    const Box = ({ type = 'info', title, children }) => { const cfg = { info: { c: colors.info, i: '‚ÑπÔ∏è' }, warn: { c: colors.warn, i: '‚ö†Ô∏è' }, danger: { c: colors.danger, i: 'üõë' }, tip: { c: colors.purple, i: 'üí°' }, success: { c: colors.success, i: '‚úì' } }; const { c, i } = cfg[type]; return (<div style={{ background: c + '15', border: `1px solid ${c}40`, borderLeft: `4px solid ${c}`, borderRadius: '0 8px 8px 0', padding: '14px 18px', margin: '14px 0' }}><div style={{ display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '6px', fontWeight: '600', color: c }}>{i} {title}</div><div style={{ color: colors.textDim, lineHeight: '1.5', fontSize: '13px' }}>{children}</div></div>); };
    const Table = ({ headers, rows }) => (<div style={{ overflowX: 'auto', margin: '16px 0' }}><table style={{ width: '100%', borderCollapse: 'collapse', fontSize: '12px' }}><thead><tr>{headers.map((h, i) => <th key={i} style={{ background: colors.bgLight, color: colors.accent, padding: '10px 12px', textAlign: 'left', borderBottom: `2px solid ${colors.accent}40` }}>{h}</th>)}</tr></thead><tbody>{rows.map((row, ri) => <tr key={ri}>{row.map((cell, ci) => <td key={ci} style={{ padding: '10px 12px', borderBottom: `1px solid ${colors.border}`, color: ci === 0 ? colors.text : colors.textDim, background: ri % 2 ? colors.bgLight + '40' : 'transparent' }}>{cell}</td>)}</tr>)}</tbody></table></div>);
    const Glow = ({ children, color = colors.accent }) => (<div style={{ position: 'relative', padding: '2px', borderRadius: '12px', background: `linear-gradient(135deg, ${color}40, transparent, ${color}20)` }}><div style={{ background: colors.bgCard, borderRadius: '10px', padding: '20px' }}>{children}</div></div>);

    // iptables Rule Builder
    const IptablesRuleBuilder = () => {
      const [table, setTable] = useState('filter');
      const [chain, setChain] = useState('INPUT');
      const [protocol, setProtocol] = useState('tcp');
      const [srcIP, setSrcIP] = useState('any');
      const [dstPort, setDstPort] = useState('80');
      const [target, setTarget] = useState('ACCEPT');

      const tables = ['filter', 'nat', 'mangle'];
      const chains = { filter: ['INPUT', 'OUTPUT', 'FORWARD'], nat: ['PREROUTING', 'POSTROUTING', 'OUTPUT'], mangle: ['INPUT', 'OUTPUT', 'FORWARD', 'PREROUTING', 'POSTROUTING'] };
      const protocols = ['tcp', 'udp', 'icmp'];
      const targets = ['ACCEPT', 'DROP', 'REJECT', 'LOG'];

      const buildCommand = () => {
        let cmd = 'iptables';
        if (table !== 'filter') cmd += ` -t ${table}`;
        cmd += ` -A ${chain}`;
        cmd += ` -p ${protocol}`;
        if (srcIP !== 'any') cmd += ` -s ${srcIP}`;
        if (protocol !== 'icmp' && dstPort) cmd += ` --dport ${dstPort}`;
        cmd += ` -j ${target}`;
        return cmd;
      };

      return (
        <div style={{ background: colors.bgCard, borderRadius: '12px', padding: '20px', border: `1px solid ${colors.border}` }}>
          <h3 style={{ color: colors.accent, marginBottom: '16px' }}>üîß iptables Rule Builder</h3>
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(130px, 1fr))', gap: '12px', marginBottom: '16px' }}>
            <div><label style={{ display: 'block', color: colors.textMuted, fontSize: '10px', marginBottom: '4px' }}>TABLE</label><select value={table} onChange={e => { setTable(e.target.value); setChain(chains[e.target.value][0]); }} style={{ width: '100%', padding: '8px', background: colors.bgLight, border: `1px solid ${colors.border}`, borderRadius: '6px', color: colors.text }}>{tables.map(t => <option key={t} value={t}>{t}</option>)}</select></div>
            <div><label style={{ display: 'block', color: colors.textMuted, fontSize: '10px', marginBottom: '4px' }}>CHAIN</label><select value={chain} onChange={e => setChain(e.target.value)} style={{ width: '100%', padding: '8px', background: colors.bgLight, border: `1px solid ${colors.border}`, borderRadius: '6px', color: colors.text }}>{chains[table].map(c => <option key={c} value={c}>{c}</option>)}</select></div>
            <div><label style={{ display: 'block', color: colors.textMuted, fontSize: '10px', marginBottom: '4px' }}>PROTOCOL</label><select value={protocol} onChange={e => setProtocol(e.target.value)} style={{ width: '100%', padding: '8px', background: colors.bgLight, border: `1px solid ${colors.border}`, borderRadius: '6px', color: colors.text }}>{protocols.map(p => <option key={p} value={p}>{p}</option>)}</select></div>
            <div><label style={{ display: 'block', color: colors.textMuted, fontSize: '10px', marginBottom: '4px' }}>SOURCE IP</label><input value={srcIP} onChange={e => setSrcIP(e.target.value)} placeholder="any" style={{ width: '100%', padding: '8px', background: colors.bgLight, border: `1px solid ${colors.border}`, borderRadius: '6px', color: colors.text, fontFamily: 'monospace', fontSize: '12px' }} /></div>
            <div><label style={{ display: 'block', color: colors.textMuted, fontSize: '10px', marginBottom: '4px' }}>DEST PORT</label><input value={dstPort} onChange={e => setDstPort(e.target.value)} placeholder="80" style={{ width: '100%', padding: '8px', background: colors.bgLight, border: `1px solid ${colors.border}`, borderRadius: '6px', color: colors.text, fontFamily: 'monospace', fontSize: '12px' }} /></div>
            <div><label style={{ display: 'block', color: colors.textMuted, fontSize: '10px', marginBottom: '4px' }}>TARGET</label><select value={target} onChange={e => setTarget(e.target.value)} style={{ width: '100%', padding: '8px', background: target === 'ACCEPT' ? colors.success + '30' : target === 'DROP' ? colors.danger + '30' : colors.bgLight, border: `1px solid ${target === 'ACCEPT' ? colors.success : target === 'DROP' ? colors.danger : colors.border}`, borderRadius: '6px', color: colors.text }}>{targets.map(t => <option key={t} value={t}>{t}</option>)}</select></div>
          </div>
          <div style={{ background: colors.bg, borderRadius: '8px', padding: '16px', fontFamily: 'monospace', fontSize: '13px' }}>
            <div style={{ color: colors.textMuted, fontSize: '10px', marginBottom: '6px' }}>COMANDO GENERATO:</div>
            <code style={{ color: colors.success }}>{buildCommand()}</code>
          </div>
        </div>
      );
    };

    // Packet Flow Visualizer
    const PacketFlowVisualizer = () => {
      const [packet, setPacket] = useState(null);
      const [step, setStep] = useState(0);
      const [packetType, setPacketType] = useState('input');

      const flows = {
        input: [
          { name: 'NETWORK IN', color: colors.info, desc: 'Pacchetto arriva dall\'esterno' },
          { name: 'PREROUTING', color: colors.warn, desc: 'Table nat: DNAT possibile' },
          { name: 'ROUTING', color: colors.textMuted, desc: 'Decisione: locale o forward?' },
          { name: 'INPUT', color: colors.success, desc: 'Table filter: filtraggio' },
          { name: 'LOCAL APP', color: colors.purple, desc: 'Applicazione locale riceve' },
        ],
        forward: [
          { name: 'NETWORK IN', color: colors.info, desc: 'Pacchetto da altra rete' },
          { name: 'PREROUTING', color: colors.warn, desc: 'Table nat: DNAT' },
          { name: 'ROUTING', color: colors.textMuted, desc: 'Decisione: forward!' },
          { name: 'FORWARD', color: colors.cyan, desc: 'Table filter: filtraggio' },
          { name: 'POSTROUTING', color: colors.warn, desc: 'Table nat: SNAT/MASQ' },
          { name: 'NETWORK OUT', color: colors.danger, desc: 'Pacchetto esce verso altra rete' },
        ],
        output: [
          { name: 'LOCAL APP', color: colors.purple, desc: 'App genera pacchetto' },
          { name: 'OUTPUT', color: colors.success, desc: 'Table filter: filtraggio' },
          { name: 'ROUTING', color: colors.textMuted, desc: 'Decisione routing' },
          { name: 'POSTROUTING', color: colors.warn, desc: 'Table nat: SNAT' },
          { name: 'NETWORK OUT', color: colors.danger, desc: 'Pacchetto esce' },
        ],
      };

      const startAnimation = (type) => {
        setPacketType(type);
        setPacket({ active: true });
        setStep(0);
        let s = 0;
        const flow = flows[type];
        const interval = setInterval(() => {
          s++;
          if (s >= flow.length) { clearInterval(interval); return; }
          setStep(s);
        }, 800);
      };

      const flow = flows[packetType];

      return (
        <div style={{ background: colors.bgCard, borderRadius: '12px', padding: '20px', border: `1px solid ${colors.border}` }}>
          <h3 style={{ color: colors.accent, marginBottom: '16px' }}>üîÄ Packet Flow Visualizer</h3>
          <div style={{ display: 'flex', gap: '8px', marginBottom: '16px', flexWrap: 'wrap' }}>
            <button onClick={() => startAnimation('input')} style={{ padding: '8px 16px', background: colors.success, border: 'none', borderRadius: '6px', color: '#fff', cursor: 'pointer', fontSize: '11px' }}>üì• INPUT (verso host)</button>
            <button onClick={() => startAnimation('forward')} style={{ padding: '8px 16px', background: colors.cyan, border: 'none', borderRadius: '6px', color: '#000', cursor: 'pointer', fontSize: '11px' }}>‚ÜîÔ∏è FORWARD (routing)</button>
            <button onClick={() => startAnimation('output')} style={{ padding: '8px 16px', background: colors.purple, border: 'none', borderRadius: '6px', color: '#fff', cursor: 'pointer', fontSize: '11px' }}>üì§ OUTPUT (da host)</button>
          </div>
          <div style={{ display: 'flex', alignItems: 'center', gap: '4px', overflowX: 'auto', padding: '10px 0' }}>
            {flow.map((f, i) => (
              <React.Fragment key={i}>
                <div style={{ minWidth: '90px', padding: '12px 8px', background: i <= step && packet ? f.color + '30' : colors.bgLight, border: `2px solid ${i <= step && packet ? f.color : colors.border}`, borderRadius: '8px', textAlign: 'center', transition: 'all 0.3s' }}>
                  <div style={{ color: i <= step && packet ? f.color : colors.textMuted, fontWeight: '600', fontSize: '10px' }}>{f.name}</div>
                  {i === step && packet && <div style={{ marginTop: '4px', fontSize: '16px' }}>üì¶</div>}
                </div>
                {i < flow.length - 1 && <div style={{ color: i < step && packet ? colors.success : colors.border, fontSize: '16px' }}>‚Üí</div>}
              </React.Fragment>
            ))}
          </div>
          {packet && <div style={{ marginTop: '12px', padding: '10px', background: flow[step].color + '15', borderRadius: '6px', fontSize: '12px', color: flow[step].color }}><strong>{flow[step].name}:</strong> {flow[step].desc}</div>}
        </div>
      );
    };

    // NAT Simulator
    const NATSimulator = () => {
      const [natType, setNatType] = useState('snat');
      const [packet, setPacket] = useState(null);

      const simulate = () => {
        if (natType === 'snat') {
          setPacket({
            before: { src: '192.168.1.100:45678', dst: '8.8.8.8:443' },
            after: { src: '203.0.113.1:45678', dst: '8.8.8.8:443' },
            desc: 'SNAT/Masquerade: IP privato tradotto in IP pubblico'
          });
        } else if (natType === 'dnat') {
          setPacket({
            before: { src: '100.0.0.50:12345', dst: '203.0.113.1:80' },
            after: { src: '100.0.0.50:12345', dst: '192.168.1.10:80' },
            desc: 'DNAT/Port Forward: Traffico diretto al server interno'
          });
        } else {
          setPacket({
            before: { src: '192.168.1.100:45678', dst: '8.8.8.8:443' },
            after: { src: '203.0.113.1:54321', dst: '8.8.8.8:443' },
            desc: 'PAT: IP e porta tradotti (molti host, un IP pubblico)'
          });
        }
      };

      return (
        <div style={{ background: colors.bgCard, borderRadius: '12px', padding: '20px', border: `1px solid ${colors.border}` }}>
          <h3 style={{ color: colors.warn, marginBottom: '16px' }}>üîÑ NAT Simulator</h3>
          <div style={{ display: 'flex', gap: '8px', marginBottom: '16px', flexWrap: 'wrap' }}>
            {[['snat', 'SNAT/Masquerade', colors.success], ['dnat', 'DNAT/Port Forward', colors.info], ['pat', 'PAT (overload)', colors.purple]].map(([type, label, color]) => (
              <button key={type} onClick={() => { setNatType(type); setPacket(null); }} style={{ padding: '8px 14px', background: natType === type ? color : colors.bgLight, border: 'none', borderRadius: '6px', color: natType === type ? '#fff' : colors.text, cursor: 'pointer', fontSize: '11px' }}>{label}</button>
            ))}
          </div>
          <button onClick={simulate} style={{ width: '100%', padding: '12px', background: colors.warn, border: 'none', borderRadius: '8px', color: '#000', fontWeight: '600', cursor: 'pointer', marginBottom: '16px' }}>‚ñ∂Ô∏è Simula Traduzione</button>
          {packet && (
            <div style={{ display: 'grid', gridTemplateColumns: '1fr auto 1fr', gap: '12px', alignItems: 'center' }}>
              <div style={{ background: colors.bgLight, borderRadius: '8px', padding: '12px' }}>
                <div style={{ color: colors.textMuted, fontSize: '10px', marginBottom: '6px' }}>PRIMA (Originale)</div>
                <div style={{ fontFamily: 'monospace', fontSize: '11px' }}>
                  <div style={{ color: colors.success }}>Src: {packet.before.src}</div>
                  <div style={{ color: colors.info }}>Dst: {packet.before.dst}</div>
                </div>
              </div>
              <div style={{ fontSize: '24px', color: colors.warn }}>‚Üí</div>
              <div style={{ background: colors.warn + '20', borderRadius: '8px', padding: '12px', border: `1px solid ${colors.warn}` }}>
                <div style={{ color: colors.warn, fontSize: '10px', marginBottom: '6px' }}>DOPO (Tradotto)</div>
                <div style={{ fontFamily: 'monospace', fontSize: '11px' }}>
                  <div style={{ color: colors.success }}>Src: {packet.after.src}</div>
                  <div style={{ color: colors.info }}>Dst: {packet.after.dst}</div>
                </div>
              </div>
            </div>
          )}
          {packet && <div style={{ marginTop: '12px', padding: '10px', background: colors.info + '15', borderRadius: '6px', fontSize: '12px', color: colors.textDim }}>{packet.desc}</div>}
        </div>
      );
    };

    const slides = [
      () => (<div style={{ textAlign: 'center', padding: '60px 30px', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', minHeight: '70vh' }}><div style={{ fontSize: '48px', marginBottom: '20px' }}>üêß</div><div style={{ fontSize: '12px', color: colors.accent, textTransform: 'uppercase', letterSpacing: '3px', marginBottom: '16px' }}>Modulo 4</div><h1 style={{ fontSize: '42px', fontWeight: '700', background: `linear-gradient(135deg, ${colors.accent}, ${colors.accentAlt})`, WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent', marginBottom: '16px' }}>Firewall Linux</h1><p style={{ fontSize: '18px', color: colors.textDim, maxWidth: '500px', lineHeight: '1.6' }}>iptables, nftables e UFW: architettura, sintassi e configurazione pratica</p></div>),
      () => (<div style={{ padding: '30px' }}><h2 style={{ color: colors.accent, marginBottom: '24px' }}>üèóÔ∏è Architettura iptables</h2><div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: '24px' }}><Glow><h3 style={{ color: colors.accent, marginBottom: '12px' }}>TABLES ‚Üí CHAINS ‚Üí RULES</h3><p style={{ color: colors.textDim, lineHeight: '1.6' }}>iptables organizza le regole in una gerarchia a 3 livelli. Ogni <strong style={{color: colors.text}}>table</strong> contiene <strong style={{color: colors.text}}>chains</strong>, e ogni chain contiene <strong style={{color: colors.text}}>rules</strong>.</p></Glow><Table headers={['Table', 'Scopo', 'Chains']} rows={[['filter', 'Filtraggio pacchetti', 'INPUT, FORWARD, OUTPUT'],['nat', 'NAT / Port forwarding', 'PREROUTING, POSTROUTING, OUTPUT'],['mangle', 'Modifica header', 'Tutte'],['raw', 'Bypass conntrack', 'PREROUTING, OUTPUT'],]} /></div><Box type="info" title="Default">Se non specifichi -t table, iptables usa automaticamente la table filter.</Box></div>),
      () => (<div style={{ padding: '30px' }}><h2 style={{ color: colors.accent, marginBottom: '24px' }}>üîÄ Flusso dei Pacchetti</h2><div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(180px, 1fr))', gap: '12px', marginBottom: '20px' }}><div style={{ background: colors.success + '20', border: `1px solid ${colors.success}`, borderRadius: '8px', padding: '14px', textAlign: 'center' }}><div style={{ color: colors.success, fontWeight: 'bold', marginBottom: '4px' }}>INPUT</div><div style={{ color: colors.textDim, fontSize: '12px' }}>Pacchetti destinati a QUESTO host</div></div><div style={{ background: colors.warn + '20', border: `1px solid ${colors.warn}`, borderRadius: '8px', padding: '14px', textAlign: 'center' }}><div style={{ color: colors.warn, fontWeight: 'bold', marginBottom: '4px' }}>FORWARD</div><div style={{ color: colors.textDim, fontSize: '12px' }}>Pacchetti che ATTRAVERSANO (routing)</div></div><div style={{ background: colors.purple + '20', border: `1px solid ${colors.purple}`, borderRadius: '8px', padding: '14px', textAlign: 'center' }}><div style={{ color: colors.purple, fontWeight: 'bold', marginBottom: '4px' }}>OUTPUT</div><div style={{ color: colors.textDim, fontSize: '12px' }}>Pacchetti generati DA questo host</div></div></div><Code title="Percorso tipico">{`NETWORK IN ‚Üí PREROUTING ‚Üí [Routing Decision]
                              ‚Üì local?     ‚Üì forward?
                            INPUT        FORWARD
                              ‚Üì              ‚Üì
                           LOCAL APP    POSTROUTING ‚Üí NETWORK OUT
                              ‚Üì
                           OUTPUT ‚Üí POSTROUTING ‚Üí NETWORK OUT`}</Code></div>),
      () => (<div style={{ padding: '30px' }}><h2 style={{ color: colors.accent, marginBottom: '24px' }}>‚å®Ô∏è Sintassi iptables</h2><Code title="Struttura comando">{`iptables [-t table] COMMAND CHAIN [match] -j TARGET

# Comandi: -A (append), -I (insert), -D (delete)
#          -L (list), -F (flush), -P (policy)`}</Code><div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: '16px' }}><Code title="Match Criteria">{`-p tcp|udp|icmp      # Protocollo
-s 192.168.1.0/24    # IP sorgente
-d 10.0.0.1          # IP destinazione
--dport 80           # Porta destinazione
--sport 1024:65535   # Range porte
-i eth0              # Interfaccia IN
-o eth1              # Interfaccia OUT
-m state --state     # Stato connessione`}</Code><Code title="Targets">{`-j ACCEPT      # Accetta
-j DROP        # Scarta silenzioso
-j REJECT      # Scarta + ICMP error
-j LOG         # Logga e continua
-j MASQUERADE  # SNAT dinamico
-j SNAT        # Source NAT
-j DNAT        # Destination NAT`}</Code></div></div>),
      () => (<div style={{ padding: '30px' }}><h2 style={{ color: colors.accent, marginBottom: '24px' }}>üìù Configurazione Server Web</h2><Code title="Script completo">{`#!/bin/bash
# Reset e policy default DENY
iptables -F && iptables -X
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT ACCEPT

# Loopback (localhost)
iptables -A INPUT -i lo -j ACCEPT

# Connessioni stabilite (FONDAMENTALE!)
iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

# SSH (porta 22)
iptables -A INPUT -p tcp --dport 22 -j ACCEPT

# HTTP e HTTPS
iptables -A INPUT -p tcp --dport 80 -j ACCEPT
iptables -A INPUT -p tcp --dport 443 -j ACCEPT

# ICMP (ping)
iptables -A INPUT -p icmp --icmp-type echo-request -j ACCEPT`}</Code><Box type="success" title="Regola d'oro">La regola ESTABLISHED,RELATED permette automaticamente il traffico di ritorno!</Box></div>),
      () => (<div style={{ padding: '30px' }}><h2 style={{ color: colors.accent, marginBottom: '24px' }}>üîÑ NAT e Masquerading</h2><div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: '16px' }}><Code title="SNAT / Masquerading">{`# Abilita IP forwarding
echo 1 > /proc/sys/net/ipv4/ip_forward

# Masquerading (IP dinamico)
iptables -t nat -A POSTROUTING \\
  -s 192.168.1.0/24 \\
  -o eth0 \\
  -j MASQUERADE

# SNAT (IP statico) - pi√π efficiente
iptables -t nat -A POSTROUTING \\
  -s 192.168.1.0/24 \\
  -o eth0 \\
  -j SNAT --to-source 203.0.113.1`}</Code><Code title="DNAT / Port Forwarding">{`# Redirige porta 80 pubblica
# verso server interno 192.168.1.100:8080

iptables -t nat -A PREROUTING \\
  -i eth0 \\
  -p tcp --dport 80 \\
  -j DNAT --to-destination 192.168.1.100:8080

# Permetti il traffico forward
iptables -A FORWARD \\
  -p tcp -d 192.168.1.100 \\
  --dport 8080 -j ACCEPT`}</Code></div><Box type="warn" title="MASQUERADE vs SNAT">MASQUERADE per IP dinamico (DHCP), SNAT per IP statico (pi√π efficiente).</Box></div>),
      () => (<div style={{ padding: '30px' }}><h2 style={{ color: colors.accent, marginBottom: '24px' }}>üíæ Persistenza Regole</h2><div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: '16px' }}><Code title="Debian/Ubuntu">{`# Salva regole correnti
iptables-save > /etc/iptables/rules.v4

# Ripristina
iptables-restore < /etc/iptables/rules.v4

# Persistenza automatica
apt install iptables-persistent
# Caricate da /etc/iptables/ al boot`}</Code><Code title="CentOS/RHEL">{`# Con iptables-services
systemctl enable iptables
service iptables save
# Salva in /etc/sysconfig/iptables

# Con firewalld (default RHEL 7+)
firewall-cmd --permanent --add-port=80/tcp
firewall-cmd --reload`}</Code></div><Box type="danger" title="Attenzione">Le regole iptables NON sono persistenti per default! Al riavvio vengono perse.</Box></div>),
      () => (<div style={{ padding: '30px' }}><h2 style={{ color: colors.cyan, marginBottom: '24px' }}>üÜï nftables - Il Successore</h2><div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: '24px' }}><Glow color={colors.cyan}><h3 style={{ color: colors.cyan, marginBottom: '12px' }}>Perch√© nftables?</h3><ul style={{ color: colors.textDim, lineHeight: '1.8', paddingLeft: '18px' }}><li><strong style={{ color: colors.text }}>Sintassi pi√π pulita</strong></li><li><strong style={{ color: colors.text }}>Framework unico</strong> (iptables + ip6tables + arptables)</li><li><strong style={{ color: colors.text }}>Performance migliori</strong></li><li><strong style={{ color: colors.text }}>Atomic updates</strong></li><li>Default su <strong style={{ color: colors.success }}>Debian 10+, RHEL 8+</strong></li></ul></Glow><Table headers={['iptables', 'nftables']} rows={[['Tables predefinite', 'Create manualmente'],['iptables + ip6tables', 'nft (comando unico)'],['-A, -I, -D', 'add, insert, delete'],['Regole una per volta', 'Regole atomiche'],]} /></div></div>),
      () => (<div style={{ padding: '30px' }}><h2 style={{ color: colors.cyan, marginBottom: '24px' }}>‚å®Ô∏è nftables - Esempio</h2><Code title="Configurazione completa /etc/nftables.conf">{`#!/usr/sbin/nft -f
flush ruleset

table inet filter {
    chain input {
        type filter hook input priority 0; policy drop;

        # Loopback
        iif lo accept

        # Connessioni stabilite
        ct state established,related accept

        # ICMP
        ip protocol icmp accept
        ip6 nexthdr icmpv6 accept

        # SSH, HTTP, HTTPS - nota la sintassi con { }
        tcp dport { 22, 80, 443 } accept

        # Log e drop
        log prefix "nft_DROP: " drop
    }

    chain forward {
        type filter hook forward priority 0; policy drop;
    }

    chain output {
        type filter hook output priority 0; policy accept;
    }
}`}</Code><Box type="tip" title="Migrazione">Usa iptables-translate per convertire regole iptables ‚Üí nftables</Box></div>),
      () => (<div style={{ padding: '30px' }}><h2 style={{ color: colors.accent, marginBottom: '24px' }}>üîÑ Confronto Sintassi</h2><div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: '16px' }}><Code title="iptables">{`# Policy DROP
iptables -P INPUT DROP

# Loopback
iptables -A INPUT -i lo -j ACCEPT

# Established
iptables -A INPUT -m state \\
  --state ESTABLISHED,RELATED -j ACCEPT

# SSH
iptables -A INPUT -p tcp --dport 22 -j ACCEPT

# HTTP + HTTPS (2 regole separate)
iptables -A INPUT -p tcp --dport 80 -j ACCEPT
iptables -A INPUT -p tcp --dport 443 -j ACCEPT`}</Code><Code title="nftables">{`table inet filter {
  chain input {
    type filter hook input priority 0;
    policy drop;

    iif lo accept

    ct state established,related accept

    tcp dport 22 accept

    # Pi√π porte insieme!
    tcp dport { 80, 443 } accept
  }
}`}</Code></div></div>),
      () => (<div style={{ padding: '30px' }}><h2 style={{ color: colors.success, marginBottom: '24px' }}>üîì UFW - Uncomplicated Firewall</h2><div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', gap: '24px' }}><Glow color={colors.success}><h3 style={{ color: colors.success, marginBottom: '12px' }}>Cos'√® UFW?</h3><ul style={{ color: colors.textDim, lineHeight: '1.8', paddingLeft: '18px' }}><li>Frontend <strong style={{ color: colors.text }}>user-friendly</strong> per iptables/nftables</li><li>Default su <strong style={{ color: colors.success }}>Ubuntu</strong> e derivate</li><li>Sintassi semplice e intuitiva</li><li>Gestisce automaticamente le regole di stato</li><li>Ideale per <strong style={{ color: colors.text }}>server e workstation</strong></li></ul></Glow><Code title="Comandi essenziali UFW">{`# Abilita/Disabilita UFW
sudo ufw enable
sudo ufw disable

# Stato e regole attive
sudo ufw status verbose

# Policy default
sudo ufw default deny incoming
sudo ufw default allow outgoing

# Permetti servizi
sudo ufw allow ssh          # Porta 22
sudo ufw allow http         # Porta 80
sudo ufw allow https        # Porta 443
sudo ufw allow 3000/tcp     # Porta specifica

# Permetti da IP specifico
sudo ufw allow from 192.168.1.0/24

# Blocca porta
sudo ufw deny 23            # Telnet

# Rimuovi regola
sudo ufw delete allow http

# Reset completo
sudo ufw reset`}</Code></div><Box type="tip" title="Best Practice">UFW √® perfetto per configurazioni semplici. Per regole complesse o NAT avanzato, usa direttamente iptables/nftables.</Box></div>),

      // Slide: iptables Rule Builder
      () => (<div style={{ padding: '30px' }}><h2 style={{ color: colors.accent, marginBottom: '24px' }}>üîß Simulatore: iptables Rule Builder</h2><IptablesRuleBuilder /><Box type="info" title="Impara facendo">Seleziona i parametri e osserva come cambia il comando iptables generato. Prova diverse combinazioni di table, chain e target!</Box></div>),

      // Slide: Packet Flow Visualizer
      () => (<div style={{ padding: '30px' }}><h2 style={{ color: colors.accent, marginBottom: '24px' }}>üîÄ Simulatore: Packet Flow</h2><PacketFlowVisualizer /><Box type="tip" title="Chain Visualization">Osserva il percorso dei pacchetti attraverso le diverse chain. INPUT per traffico locale, FORWARD per routing, OUTPUT per traffico generato.</Box></div>),

      // Slide: NAT Simulator
      () => (<div style={{ padding: '30px' }}><h2 style={{ color: colors.warn, marginBottom: '24px' }}>üîÑ Simulatore: NAT</h2><NATSimulator /><Box type="info" title="Network Address Translation">SNAT cambia l'IP sorgente (uscita), DNAT cambia l'IP destinazione (entrata), PAT traduce anche le porte per permettere a pi√π host di condividere un IP.</Box></div>),
    ];

    function App() {
      const [current, setCurrent] = useState(0);
      const total = slides.length;
      const next = () => setCurrent(c => Math.min(c + 1, total - 1));
      const prev = () => setCurrent(c => Math.max(c - 1, 0));
      useEffect(() => { const handler = e => { if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); next(); } if (e.key === 'ArrowLeft') { e.preventDefault(); prev(); } if (e.key === 'Escape') window.location.href = 'index.html'; }; window.addEventListener('keydown', handler); return () => window.removeEventListener('keydown', handler); }, []);
      return (<div style={{ minHeight: '100vh', background: colors.bg }}><div style={{ position: 'fixed', top: 0, left: 0, right: 0, height: '50px', background: colors.bgCard + 'e0', backdropFilter: 'blur(10px)', borderBottom: `1px solid ${colors.border}`, display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '0 20px', zIndex: 100 }}><div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}><a href="index.html" style={{ color: colors.textMuted, textDecoration: 'none', fontSize: '13px' }}>‚Üê Indice</a><span style={{ color: colors.border }}>|</span><span style={{ color: colors.accent, fontWeight: '600' }}>Modulo 4</span><span style={{ color: colors.textDim }}>Firewall Linux</span></div><div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}><span style={{ color: colors.textMuted, fontSize: '13px' }}>{current + 1} / {total}</span><div style={{ width: '100px', height: '4px', background: colors.bgLight, borderRadius: '2px' }}><div style={{ height: '100%', width: `${((current + 1) / total) * 100}%`, background: colors.accent, borderRadius: '2px', transition: 'width 0.3s' }} /></div></div></div><div style={{ paddingTop: '50px', paddingBottom: '70px', minHeight: 'calc(100vh - 120px)' }}><div style={{ maxWidth: '1200px', margin: '0 auto', padding: '0 24px' }}>{slides[current]()}</div></div><div style={{ position: 'fixed', bottom: 0, left: 0, right: 0, height: '60px', background: colors.bgCard + 'e0', backdropFilter: 'blur(10px)', borderTop: `1px solid ${colors.border}`, display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '16px', zIndex: 100 }}>{current === 0 && <a href="modulo3-acl.html" style={{ padding: '10px 24px', background: colors.bgCard, border: `1px solid ${colors.border}`, borderRadius: '8px', color: colors.text, textDecoration: 'none', fontSize: '14px' }}>‚Üê Modulo 3</a>}{current > 0 && <button onClick={prev} style={{ padding: '10px 24px', background: colors.bgCard, border: `1px solid ${colors.border}`, borderRadius: '8px', color: colors.text, cursor: 'pointer', fontSize: '14px' }}>‚Üê Indietro</button>}<button onClick={next} disabled={current === total - 1} style={{ padding: '10px 24px', background: current === total - 1 ? colors.bgLight : `linear-gradient(135deg, ${colors.accent}, ${colors.accentAlt})`, border: 'none', borderRadius: '8px', color: current === total - 1 ? colors.textMuted : '#000', cursor: current === total - 1 ? 'not-allowed' : 'pointer', fontSize: '14px', fontWeight: '600' }}>Avanti ‚Üí</button>{current === total - 1 && <a href="modulo5-windows-firewall.html" style={{ padding: '10px 24px', background: `linear-gradient(135deg, ${colors.purple}, #9333ea)`, border: 'none', borderRadius: '8px', color: '#fff', textDecoration: 'none', fontSize: '14px', fontWeight: '600' }}>Modulo 5 ‚Üí</a>}</div></div>);
    }
    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
